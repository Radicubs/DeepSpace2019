#include <Wire.h>
#include <Pixy2.h>
#include <stdio.h>
#include <math.h>

Pixy2 pixy;

void setup()
{
  Serial.begin(9600);
  Wire.begin(4);

//initialize the pixy object
  pixy.init();
  pixy.changeProg("line_tracking");

  //Sets ideal conditions for Pixycam
  pixy.setLamp(1,1);
  pixy.setCameraBrightness(40);
}

char xAsString[8] = "";

void loop()
{
  Wire.onRequest(requestEvent);
  pixy.line.getAllFeatures();

//Gets Coordiantes of Vectors 
  int x0 = pixy.line.vectors[0].m_x0;
  int x1 = pixy.line.vectors[0].m_x1;
  int y0 = pixy.line.vectors[0].m_y0;
  int y1 = pixy.line.vectors[0].m_y1;

  double angle = atan((y1-y0)/(x1-x0));
  int degreeAngle = angle*57.2958;
  
  memset(xAsString, 0, strlen(xAsString));
  //xAsString[0] = '\0';
  sprintf(xAsString, "%d", degreeAngle);
  Serial.println(xAsString);
  delay(100);
}

void requestEvent() {
  Wire.write(xAsString);
}